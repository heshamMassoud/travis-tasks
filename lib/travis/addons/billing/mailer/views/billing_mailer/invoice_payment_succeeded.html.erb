<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <style type="text/css" media="screen">
      body {
        min-width: 100%;
        height: 100%;
        margin: 0;
        padding: 0;
      }

      body, td {
        font-family: 'Source Sans Pro', 'Helvetica Neue', Helvetica, Arial, sans-serif;
      }

      hr {
        border-style: solid;
        color: #e5e7e9;
        margin: 1em 0;
      }

      #travis-ci-email-container {
        height: 100%;
        width: 100%;
        padding: 30px;
        font-family: 'Source Sans Pro', 'Helvetica Neue', Helvetica, Arial, sans-serif;
        text-align: center;
        color: #333333;
        line-height: 1.4;
        background-color: #f6f7fa;
      }

      #email-central-container {
        font-family: inherit;
        width: 500px;
      }

      #email-content-container {
        padding: 6% 7% 5% 7%;
        background-color: #FFFFFF;
        width: 100%;
      }

      #email-content-container p {
        font-size: 16px;
        margin: 0 0 10px 0;
      }

      .invoice-header-container {
        text-align: center;
      }

      #invoice-header {
        font-size: 42px;
        font-weight: 600;
        margin: 1.136% 0 6.818% 0;
        color: #0068ff;
      }

      .blue-highlight {
        color: #0068ff;
      }

      .download-and-update {
        text-align: center;
      }

      #travis-ci-email-footer-container {
        padding: 10% 7% 0% 7%;
      }

      #questions-section {
        font-size: 18px;
        color: #0068ff;
        padding-bottom: 10.227%;
      }

      #questions-section a {
        color: #0068ff;
      }

      #travis-ci-footer-logo-section {
        padding-bottom: 6.818%;
        text-align: center;
      }

      #email-footer-section {
        font-size: 11px;
        color: #9EA3A8;
        text-align: center;
        padding-top: 0px;
        margin: 0px;
      }

      #email-footer-section a {
        color: #9ea3a8;
      }

      #email-footer-section p {
        margin: 0px;
      }

      #email-footer-section #payment-processor-message {
        margin-bottom: 3.409%;
        padding: 0 1%;
      }
    </style>
  </head>

  <body>

    <table
      id="travis-ci-email-container"
      align="center"
      border="0"
      cellpadding="0"
      cellspacing="0"
      height="100%"
      width="100%">
      <!-- Main Content Section -->
      <tr>
        <td align="center" valign="top">
          <table id="email-central-container" border="0" cellpadding="0" cellspacing="0">
            <tr>
              <td>
                <table id="email-content-container" border="0" cellpadding="0" cellspacing="0">
                  <!-- Header - Thanks -->
                  <tr>
                    <td class="invoice-header-container">
                      <h2 id="invoice-header">Thank you.</h2>
                      <p>
                        We love our customers! Below is your Travis CI invoice for the account
                        <span class="blue-highlight"><%# @subscription.owner.login %></span>.
                      </p>
                      <% unless Travis.env == "production" %>
                        <p>Test Email! Not a valid invoice!</p>
                      <% end -%>
                    </td>
                  </tr>
                  <tr>
                    <td><hr /></td>
                  </tr>
                  <!-- Main Invoice Content -->
                  <tr>
                    <td>
                      <table class="invoice-address-and-total">
                        <tr>
                          <td class="invoice-address-container">
                            <label class="label-grey">Billed To:</label>
                            <address>
                              <div>
                                <% if @subscription[:company].present? %>
                                  <%= @subscription[:company] %>
                                <% end %>
                              </div>
                              
                              <div>
                                <% if @subscription[:first_name].present? %>
                                    <%= @subscription[:first_name] %>
                                <% end %>
                                <% if @subscription[:last_name].present? %>
                                    <%= @subscription[:last_name] %>
                                <% end %>
                              </div>

                              <div>
                                <% if @subscription[:address].present? %>
                                    <%= @subscription[:address] %>
                                <% end %>
                              </div>

                              <div>
                              <% if @subscription[:city].present? %>
                                  <%= @subscription[:city] %>
                              <% end %>
                                <% if @subscription[:zip_code].present? %>
                                    <%= @subscription[:zip_code] %>
                                <% end %>
                              </div>

                              <%# %w(state country vat_id).each do |attr| %>
                                <div>
                                  <%# if @subscription.send(attr.to_sym).present? %>
                                    <%# @subscription[attr.to_sym] %><br>
                                  <%# end %>
                                </div>
                              <%# end %>
                            </address>
                          </td>
                          <td class="invoice-total-container">
                            <label class="label-grey">Total (In USD)</label>
                            <div class="total-large">
                              <%# number_to_currency(@invoice.object["amount_due"] / 100.0) %>
                            </div>
                            <p><time datetime="sdjdj"><%# l @invoice[:created_at], format: :long %></time></p>
                          </td>
                        </tr>
                      </table>
                    </td>
                  </tr>
                  <tr>
                    <td>
                      <label class="label-black">Invoice #<%# @invoice.invoice_id %></label>
                    </td>
                  </tr>
                  <tr>
                    <td>
                      <label class="label-blue">Subscription Period</label>
                      <span>
                        <%# l set_period(@invoice.object, "start", @subscription), format: :long -%>
                        &ndash;
                        <%# l set_period(@invoice.object, "end", @subscription), format: :long -%>
                      </span>
                    </td>
                  </tr>
                  <tr>
                    <td>
                      <label class="label-blue">Status</label>
                      <span>Paid with credit card ending in <%# @charge_cc_last_digits %></span>
                    </td>
                  </tr>
                  <%# unless is_proration?(@invoice.object) %>
                    <tr>
                      <td>
                        <label class="label-blue">Plan</label>
                        <span><%# Travis::Billing.config.plans[parse_subscription(@invoice.object)["plan"]["id"].to_sym][:name] %></span>
                      </td>
                    </tr>
                  <%# end %>
                  <tr>
                    <td>
                      <label class="label-blue">Price</label>
                      <span><%# number_to_currency(get_plan_amount(@invoice.object) / 100.0) %></span>
                    </td>
                  </tr>

                  <%# (invoice_items(@invoice.object) || []).each do |invoice_item| %>
                    <tr>
                      <td>
                        <label class="label-blue"><%# invoice_item["description"] %></label>
                        <span><%# number_to_currency(invoice_item["amount"] / 100.0) %></span>
                      </td>
                    </tr>
                  <%# end -%>

                  <%# unless @subscription.vat_required? -%>
                    <!--<tr>
                      <td>
                        <label class="label-blue">VAT ({Percent})</label>
                        <span>{VAT}</span>
                      </td>
                    </tr>-->
                  <%# end -%>

                  <%# if @invoice.object["discount"].present? %>
                    <tr>
                      <td>
                        <label class="label-blue">Discount</label>
                        <span>
                          <%# if @invoice.object["discount"]["coupon"]["percent_off"] -%>
                            <%# @invoice.object["discount"]["coupon"]["percent_off"] %>%
                          <%# else -%>
                            <%# number_to_currency(@invoice.object["discount"]["coupon"]["amount_off"] / 100.0) %>
                          <%# end -%>
                        </span>
                      </td>
                    </tr>
                  <%# end -%>

                  <%# if (balance = @invoice.object["starting_balance"].to_i) != 0 -%>
                    <tr>
                      <td>
                        <label class="label-blue"><%# balance > 0 ? "Debit" : "Credit" %></label>
                        <span><%# applied_balance(balance, @invoice.object["ending_balance"]) %></span>
                      </td>
                    </tr>
                  <%# end -%>

                  <tr>
                    <td>
                      <label class="label-black">Total</label>
                      <span><%# number_to_currency(@invoice.object["amount_due"] / 100.0) %></span>
                    </td>
                  </tr>
                  <tr>
                    <td><hr /></td>
                  </tr>

                  <!-- Download and update -->
                  <% if not @hide_pdf_notice -%>
                    <tr>
                      <td class="download-and-update">
                        <p>
                          <a href="<%# invoice_url(Digest::SHA1.hexdigest(@invoice.stripe_id + @invoice.invoice_id), format: 'pdf', protocol: 'https') %>">
                            <!-- <img alt="PDF icon" /> -->
                            Download a PDF copy
                          </a>
                        </p>
                        <p>
                          Need to change your billing address? Update it
                          <a href="<%# edit_subscription_url(@subscription.owner.login, protocol: 'https') %>" >here</a>.
                        </p>
                      </td>
                    </tr>
                  <% end -%>
                </table>

                <!-- Email Footer Section -->
                <table id="travis-ci-email-footer-container" border="0" cellpadding="0" cellspacing="0">
                  <tr>
                    <td id="questions-section" align="center" valign="top">
                      <span>Have any questions?</span>
                      <span>
                        <a href="mailto:support@travis-ci.com">We&rsquo;re here to help.</a>
                      </span>
                    </td>
                  </tr>
                  <tr>
                    <td id="travis-ci-footer-logo-section">
                      <%= link_to(image_tag("#{Travis.config.s3.url}/TravisCI-Logo-BW.png", alt: 'black and white travis ci logo'), 'https://travis-ci.com')%>
                    </td>
                  </tr>
                  <tr>
                    <td id="email-footer-section">
                      <p id="payment-processor-message">
                        We use <a href="https://stripe.com">Stripe Inc.</a>, 3180 18th Street, Suite 100, San Francisco, CA 94110, USA, as our payment partner
                      </p>
                      <p>
                        Travis CI GmbH, Rigaer Str. 8, 10427 Berlin, Germany | GF/CEO: Konstantin Haase, Fritz Thielemann |
                        <span>Contact: <%= link_to('contact@travis-ci.com', 'mailto:contact@travis-ci.com', style: 'color: #9EA3A8')%> | Amtsgericht Charlottenburg, Berlin, HRB 140133 B | Umsatzsteuer-ID gemäß §27 a Umsatzsteuergesetz: DE282002648</span>
                      </p>
                    </td>
                  </tr>
                </table>
              </td>
            </tr>
          </table>
        </td>
      </tr>
    </table>
  </body>
</html>
